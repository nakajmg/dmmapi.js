<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>dmmapi.js</title>
    <style>
      #content { margin: 0 auto; text-align: center; }
      #content input { width: 200px; height: 40px; }
      #content button { width: 200px; line-height: 35px;font-size: 16px; }
      #content p { text-align: left; margin: 3px 0; }
    </style>
  </head>
<body>
<div id="content" style="font-size: 14px;"></div>


<script src="js/libs.js"></script>
<script src="js/vue.min.js"></script>
<script src="js/dmmapi.js"></script>
<script charset="utf-8">

document.addEventListener("DOMContentLoaded", function() {
  
  window.content = new Vue({
    el: "#content",
    template: (function () {/*
      <div>
        <input type='text' v-model='keyword' autofocus>
        <button v-on='click: fetch' v-attr='disabled: fetching'>fetch</button>
      </div>
      <p v-repeat='items'>
        <a v-attr='href:URL' target='_blank'>{{title}}</a>
      </p>
    */}).toString().match(/[^]*\/\*([^]*)\*\/\}$/)[1],
    
    ready: function() {
      this.dmm = new DMM({
        apiId: 'hsdnAGPUbCRFUDQCM925',
        affiliateId: 'jmglabo-990',
        site: 'DMM.co.jp'
      });
    },
    
    data: {
      keyword: "コスプレ",
      fetching: false
    },
    
    methods: {
      copy: function(json) {
        if (!json) { return; }
        return JSON.parse(JSON.stringify(json));
      },
      fetch: function() {
        var _this = this;
        var params = {};
        this.fetching = true;
        this.prevResult = this.copy(this.lastResult);
        params.keyword = this.keyword;
        this.dmm.request(params).then(function(data) {
          _this.lastResult = data;
          _this.fetching = false;
          _this.items = data.items.item;
        });
      }
    }
  });
});
    
  
</script>
</body>
</html>
